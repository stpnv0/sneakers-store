# Sneakers Store - Микросервисная архитектура

Проект интернет-магазина кроссовок с микросервисной архитектурой, реализованный на Go и React.

## Обзор проекта

Sneakers Store - это полноценный интернет-магазин кроссовок, построенный на основе микросервисной архитектуры. Проект включает в себя следующие компоненты:

- **Основной сервис** - обрабатывает запросы клиентов, управляет товарами и проксирует запросы к другим микросервисам
- **SSO сервис** - обеспечивает аутентификацию и авторизацию пользователей через gRPC
- **Микросервис корзины** - управляет корзиной пользователя с использованием паттерна Cache-Aside
- **Микросервис избранного** - управляет списком избранных товаров пользователя
- **Фронтенд** - клиентское приложение на React

## Архитектура

![Архитектура проекта](docs/architecture.png)

### Основные компоненты

1. **Backend (основной сервис)**
   - Обрабатывает запросы клиентов
   - Управляет каталогом товаров
   - Проксирует запросы к микросервисам
   - Взаимодействует с SSO сервисом для аутентификации и авторизации

2. **SSO Service (сервис аутентификации)**
   - Обеспечивает единую точку аутентификации и авторизации
   - Реализован с использованием gRPC для высокопроизводительного взаимодействия
   - Управляет пользователями, ролями и разрешениями
   - Выдает JWT токены для авторизации в других сервисах

3. **Cart Service (микросервис корзины)**
   - Управляет корзиной пользователя
   - Использует паттерн Cache-Aside для оптимизации производительности
   - Хранит данные в PostgreSQL и кэширует в Redis

4. **Favourites Service (микросервис избранного)**
   - Управляет списком избранных товаров пользователя
   - Также использует паттерн Cache-Aside
   - Хранит данные в PostgreSQL и кэширует в Redis

5. **Frontend**
   - Клиентское приложение на React
   - Взаимодействует с бэкендом через REST API

## Технологии

### Backend
- **Язык программирования**: Go
- **Web-фреймворк**: Gin
- **RPC фреймворк**: gRPC (для SSO сервиса)
- **База данных**: PostgreSQL
- **Кэширование**: Redis
- **Контейнеризация**: Docker

### Frontend
- **Язык программирования**: JavaScript/TypeScript
- **Фреймворк**: React
- **Управление состоянием**: React Context API
- **Стилизация**: SCSS Modules

## Паттерны проектирования

### Cache-Aside
В проекте активно используется паттерн Cache-Aside для оптимизации производительности:

1. При запросе данных сначала проверяется кэш (Redis)
2. Если данные найдены в кэше и не пустые, они возвращаются клиенту
3. Если данных нет в кэше или они пустые, данные загружаются из базы данных (PostgreSQL)
4. Загруженные данные сохраняются в кэш для последующих запросов
5. При изменении данных обновляются как база данных, так и кэш

### API Gateway
Основной сервис выступает в роли API Gateway, проксируя запросы к соответствующим микросервисам.

### gRPC для межсервисного взаимодействия
SSO сервис использует gRPC для высокопроизводительного взаимодействия с основным сервисом:
1. Бинарный протокол передачи данных обеспечивает высокую производительность
2. Строгая типизация через Protocol Buffers
3. Поддержка потоковой передачи данных
4. Генерация клиентского и серверного кода

## Запуск проекта

### Предварительные требования
- Docker и Docker Compose
- Go 1.19+
- Node.js 16+

### Шаги для запуска

1. Клонировать репозиторий:
```bash
git clone https://github.com/yourusername/sneakers-store.git
cd sneakers-store
```

2. Запустить все сервисы с помощью Docker Compose:
```bash
docker-compose up -d
```

3. Проверить, что все сервисы запущены:
```bash
docker-compose ps
```

4. Открыть приложение в браузере:
```
http://localhost:5173
```

## Структура проекта

```
sneakers/
├── sneakers_store/         # Основной сервис
│   ├── backend/            # Бэкенд основного сервиса
│   └── frontend/           # Фронтенд на React
├── cart_service/           # Микросервис корзины
├── fav_service/            # Микросервис избранного
├── sso_service/            # SSO сервис на gRPC
├── docker-compose.yml      # Конфигурация Docker Compose
└── README.md               # Документация проекта
```

## Особенности реализации

### SSO сервис на gRPC
- Реализует единую точку аутентификации и авторизации для всех сервисов
- Использует gRPC для высокопроизводительного взаимодействия с другими сервисами
- Выдает JWT токены для авторизации пользователей
- Поддерживает различные методы аутентификации (логин/пароль, OAuth)
- Управляет пользователями, ролями и разрешениями
- Обеспечивает безопасность всей системы

### Микросервис корзины
- Использует паттерн Cache-Aside для оптимизации производительности
- Хранит данные в PostgreSQL и кэширует в Redis
- Обеспечивает консистентность данных между базой данных и кэшем
- Поддерживает операции добавления, удаления и обновления товаров в корзине

### Микросервис избранного
- Аналогично использует паттерн Cache-Aside
- Обеспечивает быстрый доступ к списку избранных товаров пользователя
- Поддерживает операции добавления и удаления товаров из избранного

### Основной сервис
- Проксирует запросы к микросервисам
- Взаимодействует с SSO сервисом для аутентификации и авторизации
- Управляет каталогом товаров

## Процесс аутентификации

1. Пользователь отправляет учетные данные (логин/пароль) на основной сервис
2. Основной сервис перенаправляет запрос на SSO сервис через gRPC
3. SSO сервис проверяет учетные данные и генерирует JWT токен
4. Токен возвращается пользователю и сохраняется в localStorage браузера
5. При последующих запросах токен отправляется в заголовке Authorization
6. Основной сервис проверяет токен через SSO сервис и предоставляет доступ к ресурсам

## Возможные проблемы и их решение

### Пустая корзина после перезапуска
Если после перезапуска приложения корзина отображается пустой, хотя в базе данных есть товары, возможно, в Redis хранится пустая корзина. Решение:

1. Очистить кэш Redis:
```bash
docker exec cart_redis redis-cli KEYS "cart:*" | xargs -r docker exec cart_redis redis-cli DEL
```

2. Перезапустить микросервис корзины:
```bash
docker restart sneakers_cart
```

### Проблемы с аутентификацией
Если возникают проблемы с аутентификацией:

1. Проверить, что SSO сервис запущен и доступен:
```bash
docker logs sneakers_sso
```

2. Проверить соединение между основным сервисом и SSO сервисом:
```bash
docker exec sneakers_backend ping sneakers_sso
```

## Дальнейшее развитие проекта

- Добавление системы оплаты
- Интеграция с системой доставки
- Добавление системы отзывов и рейтингов
- Реализация системы рекомендаций
- Добавление административной панели
- Расширение функциональности SSO сервиса (двухфакторная аутентификация, OAuth интеграции)

## Лицензия

MIT